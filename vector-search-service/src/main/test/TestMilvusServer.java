import com.newland.tianyan.vectorsearch.VectorSearchApplication;
import com.newland.tianyan.vectorsearch.vo.QueryRes;
import com.newland.tianyan.vectorsearch.service.MilvusService;
import org.aspectj.weaver.ast.Var;
import org.junit.Assert;
import org.junit.Test;
import org.junit.experimental.theories.FromDataPoints;
import org.junit.runner.RunWith;
import org.springframework.beans.factory.annotation.Autowired;
import org.springframework.boot.test.context.SpringBootTest;
import org.springframework.test.context.junit4.SpringRunner;

import java.util.LinkedList;
import java.util.List;

/**
 * @Author: huangJunJie  2021-02-04 17:38
 */
@RunWith(SpringRunner.class)
@SpringBootTest(classes = VectorSearchApplication.class)
public class TestMilvusServer {

    @Autowired
    private MilvusService milvusService;

    @Test
    public void testInsert() {
        String appId = "face";

        List<Float> query_list = new LinkedList<>();
        String strFeature = "-0.0055829533, -0.05252821, 0.045498915, 0.027684057, -0.014731865, 0.017963886, 0.023751553, 0.05204888, -0.017745322, -0.064760566, 0.020972243, 0.048426833, -0.07709769, -0.021441981, 0.028780727, 0.04748312, -0.06179707, -0.053059425, 0.030665006, 0.022615338, -0.06291669, 0.067358434, -0.022109438, 0.06483583, 0.059896298, -0.03453572, 0.054612305, 0.016745212, -0.108223155, -0.06908608, -0.024598412, -0.0265966, -0.03950638, -0.0034397007, -0.042136118, -0.05123543, 0.0590316, -0.049851395, -0.034447048, 0.014572497, 0.037975308, 0.027077494, 0.06131909, 0.040654838, 0.024475677, 0.027959708, 0.057738606, -0.04608711, -0.01920095, -0.07413682, -0.048362654, -0.021702839, -0.020294387, -0.006079467, -0.06403117, -0.085131116, 0.0059753354, 0.0331481, -0.005049809, 0.07701836, 0.038597703, 0.0016531858, 0.062389836, -0.055956904, -0.09093616, -0.0069559976, -0.024187777, -0.0013998124, 0.011885589, 0.008950807, 0.032283496, -0.026219485, -0.016282247, 0.022982227, -0.0020866033, 0.0124436, -0.0026165033, 0.0094944, -0.035333574, -0.046104934, 0.045540523, 0.061459623, -0.005642663, -0.026882628, 0.03501887, 0.068248324, -0.022550117, -0.01283464, -0.09680264, 0.013322089, -0.0037654832, -0.0066057243, 0.035339862, 0.047094923, -1.7291073E-4, 0.023921039, -0.06834752, -4.5249547E-4, 0.028334497, 0.03943491, -0.036323104, 0.037875548, -0.037171885, 0.07799917, -0.009970036, -0.0137152895, 0.043048568, -0.023905173, -0.0038948571, -0.020153917, -0.018465197, 0.020302152, 0.009679929, -0.016298441, -0.049297065, -0.058576874, 0.026938241, -0.010931162, 0.013422858, 0.056898456, -0.048746306, 0.026552347, -0.017022101, 0.04336353, 0.03464659, 4.640521E-4, -0.004665707, 0.036609724, -0.06378838, 0.042397253, -0.011159567, -0.0047367476, -0.061266672, -0.04507367, 0.06943897, -0.05169623, -0.03327603, 0.04451255, -0.0076074977, -0.00877303, 0.009340342, -0.03858022, -0.042426832, 0.052511275, 0.110036656, -0.046440795, -0.010793275, -0.0073878323, 0.0022409128, -0.028041992, -0.03263694, 0.033953637, -0.053477813, -0.015962001, 0.04837572, -0.07061127, 0.0046661943, 0.014093273, -0.049537174, -0.0446542, 0.02700122, 0.033376053, -0.09943011, -0.06626195, -0.09429548, 0.029650288, 0.023459174, -0.0017580914, -0.01362791, -0.018901518, 0.047988545, -0.0012865294, 0.020184763, -0.04141823, -0.075608306, -0.0100300135, -0.062187422, 0.02398144, 0.025065396, -0.013512214, 0.064370096, 0.019878363, -0.020921059, 0.035334315, 0.03567038, -0.013564578, 0.014935359, 0.05767741, -0.027855853, 0.072637424, 0.020254267, 0.06742414, 0.03082894, -0.063118555, -0.018025378, 0.02366266, 0.0045260526, 0.11448336, 0.0189172, -0.006509951, -0.015901005, -0.0023374262, -0.02125802, -0.016092516, 0.099977374, -0.023346974, -0.011715805, -0.05170041, 0.08855681, 0.02657749, -0.047030363, 0.07507626, -0.0036172476, -0.011332732, 0.09223379, -0.035123598, 0.07849929, -0.0073014772, -0.06407317, -0.041441977, 0.042889312, 0.038899496, -0.028433122, 0.013948647, 0.03332241, -0.009083656, 0.013755987, -0.038682193, 0.012088305, 8.459411E-4, -0.047591258, -0.03445639, -0.024129298, 0.03151862, 0.06664521, 0.008410466, -0.04966618, -3.5810814E-4, -0.05254022, 0.032581992, 0.076965645, -0.008174543, 0.024454173, 0.058821585, -0.036225654, -0.036327284, 0.010284759, 0.0026733254, 0.012767942, 0.044172868, 0.079714224, 0.02428882, -0.058098882, -0.103700064, 0.036374588, 0.028864969, 0.057181194, -0.03133973, -0.036992326, -0.024063826, 0.032124367, -0.046390727, 0.06676919, -0.010181497, -0.07662079, 0.0016703316, -0.018343225, -0.047778722, 0.017997596, 0.03181875, -0.052517273, -0.010668479, 0.064985715, 0.039871912, 0.01582545, -0.007435942, -0.037521612, -0.041268304, -0.024208354, 0.019123953, -0.057927314, -0.042535316, -0.026476882, -0.025740117, -0.062421277, -0.008162225, 0.059145488, -0.06572626, 0.0068042623, -0.013353639, 0.045686264, 0.05418521, 0.04446112, 0.017125841, -0.056843452, -0.05248872, 0.009996208, -0.014766493, 0.047614425, 0.04417578, 0.09312503, 0.022321783, 0.06672458, -0.020294214, 0.06058907, -0.07796509, -0.017752886, -0.035484698, -0.019245343, -0.086269155, 0.03636968, -0.010473155, -0.027821833, 0.08724536, -0.036087383, -0.026622012, 0.012954949, -0.04286149, 0.057656605, 0.10062613, -0.0024973156, 0.026387101, 0.0060166116, -0.0025189642, -0.02720747, 0.005246455, 0.05420245, 2.9386661E-4, -0.032994796, -0.07233637, 0.01421499, -0.08565736, -0.066092595, 0.04123878, -0.057052527, 0.05104476, -0.022676067, 0.024916856, 0.043550193, 0.022787891, 0.06634744, 0.06282198, -0.028120825, 0.03855068, 0.029932909, -0.014963516, -0.023962902, 0.0330809, 0.027074838, -0.07884763, 0.009013065, -0.050303705, 0.04903634, 0.048968226, 0.025972977, 0.0059105, 0.026412955, 0.09550425, -0.041806895, 0.037700027, -0.00944356, -0.04365178, -0.003731535, -0.04677017, -0.021983983, -0.017476812, -0.0349582, 0.022780418, 0.02312234, -0.008466284, -0.048668552, -0.064449385, -0.039475206, -0.028146911, 0.02474613, -0.047006067, -0.0019405297, 0.031159727, 0.041920133, -0.03551462, -0.009635197, 0.002173243, 0.016199356, -0.0026587702, -0.040665075, 0.025064465, 0.039028086, 0.0410654, -0.052680694, 0.03621542, 0.05137614, -0.025629448, -0.022262543, -0.050236598, -0.06712357, -0.08511359, -0.020049553, 0.05228086, 0.01210039, -0.049958818, 0.03553515, -0.014649628, 0.01852075, -0.1578007, 0.04647171, -0.048130322, -0.11456476, 0.043893646, -0.039123375, -0.06064546, 0.022642506, 0.024047757, -0.038108468, -0.027887572, -0.035452798, -0.06386947, -0.059311286, -0.0597525, -0.033028368, -0.027785469, -0.014255441, 0.015038763, 0.031091997, 0.005895148, 0.056737326, 0.04310527, -0.021932026, 0.049093824, 0.042565376, 0.0024186873, -0.062797636, 0.07696433, -0.07480409, -0.002757164, 0.037501466, -0.0038974392, 0.013958516, -0.023316862, -0.02243059, -0.014469609, -0.072872445, -0.045017675, -0.09662722, -0.06683428, -0.076667175, 0.016889855, -0.05259447, 0.09901151, 0.008826699, 0.051874604, -0.063310854, 0.010331116, 0.0569754, 0.022930646, 0.015946256, -0.006152074, -0.063890666, -0.007055935, 0.022711016, 0.06597431, -0.016773408, 0.0454886, -0.022848401, 0.05452045, -0.04897417, -0.019524746, -0.06592306, -0.019679544, -0.009023872, -0.058356464, 0.06706891, -0.056862935, 0.048966084, 0.026170777, 0.034578174, -0.030989857, -0.025572322, -0.04439888, -0.037672643, 0.057903234, -0.027281458, -0.0067445496, 0.082111515, -6.9222995E-4, -0.031044275, -0.03536472, -0.03539842, 0.0015799046, -0.056929786, -0.026974991, 0.024494532, 0.062562846, 0.022763105, -0.03143849, 0.063723214, 0.03694335, -0.012629538, -0.0185742, -0.032778334, 0.007738178, -0.046297673, 0.11095108, 0.033049, 0.023627881, 0.078807965, -0.0134094, 0.007088767, -0.061255455, 0.0019925626, -0.028554654, -0.05853438, -0.045480233";
        String[] s = strFeature.replace(" ", "").split(",");
        for (String temp : s) {
            query_list.add(Float.parseFloat(temp));
        }

        Long entityId = 20000L;

        Long resId = milvusService.insert(appId, query_list, entityId);
        System.out.println(resId);
        Assert.assertEquals(entityId, resId);
    }

    @Test
    public void testQuery() {
        String appId = "face";

        List<Float> query_list = new LinkedList<>();
        String strFeature = "-0.0055829533, -0.05252821, 0.045498915, 0.027684057, -0.014731865, 0.017963886, 0.023751553, 0.05204888, -0.017745322, -0.064760566, 0.020972243, 0.048426833, -0.07709769, -0.021441981, 0.028780727, 0.04748312, -0.06179707, -0.053059425, 0.030665006, 0.022615338, -0.06291669, 0.067358434, -0.022109438, 0.06483583, 0.059896298, -0.03453572, 0.054612305, 0.016745212, -0.108223155, -0.06908608, -0.024598412, -0.0265966, -0.03950638, -0.0034397007, -0.042136118, -0.05123543, 0.0590316, -0.049851395, -0.034447048, 0.014572497, 0.037975308, 0.027077494, 0.06131909, 0.040654838, 0.024475677, 0.027959708, 0.057738606, -0.04608711, -0.01920095, -0.07413682, -0.048362654, -0.021702839, -0.020294387, -0.006079467, -0.06403117, -0.085131116, 0.0059753354, 0.0331481, -0.005049809, 0.07701836, 0.038597703, 0.0016531858, 0.062389836, -0.055956904, -0.09093616, -0.0069559976, -0.024187777, -0.0013998124, 0.011885589, 0.008950807, 0.032283496, -0.026219485, -0.016282247, 0.022982227, -0.0020866033, 0.0124436, -0.0026165033, 0.0094944, -0.035333574, -0.046104934, 0.045540523, 0.061459623, -0.005642663, -0.026882628, 0.03501887, 0.068248324, -0.022550117, -0.01283464, -0.09680264, 0.013322089, -0.0037654832, -0.0066057243, 0.035339862, 0.047094923, -1.7291073E-4, 0.023921039, -0.06834752, -4.5249547E-4, 0.028334497, 0.03943491, -0.036323104, 0.037875548, -0.037171885, 0.07799917, -0.009970036, -0.0137152895, 0.043048568, -0.023905173, -0.0038948571, -0.020153917, -0.018465197, 0.020302152, 0.009679929, -0.016298441, -0.049297065, -0.058576874, 0.026938241, -0.010931162, 0.013422858, 0.056898456, -0.048746306, 0.026552347, -0.017022101, 0.04336353, 0.03464659, 4.640521E-4, -0.004665707, 0.036609724, -0.06378838, 0.042397253, -0.011159567, -0.0047367476, -0.061266672, -0.04507367, 0.06943897, -0.05169623, -0.03327603, 0.04451255, -0.0076074977, -0.00877303, 0.009340342, -0.03858022, -0.042426832, 0.052511275, 0.110036656, -0.046440795, -0.010793275, -0.0073878323, 0.0022409128, -0.028041992, -0.03263694, 0.033953637, -0.053477813, -0.015962001, 0.04837572, -0.07061127, 0.0046661943, 0.014093273, -0.049537174, -0.0446542, 0.02700122, 0.033376053, -0.09943011, -0.06626195, -0.09429548, 0.029650288, 0.023459174, -0.0017580914, -0.01362791, -0.018901518, 0.047988545, -0.0012865294, 0.020184763, -0.04141823, -0.075608306, -0.0100300135, -0.062187422, 0.02398144, 0.025065396, -0.013512214, 0.064370096, 0.019878363, -0.020921059, 0.035334315, 0.03567038, -0.013564578, 0.014935359, 0.05767741, -0.027855853, 0.072637424, 0.020254267, 0.06742414, 0.03082894, -0.063118555, -0.018025378, 0.02366266, 0.0045260526, 0.11448336, 0.0189172, -0.006509951, -0.015901005, -0.0023374262, -0.02125802, -0.016092516, 0.099977374, -0.023346974, -0.011715805, -0.05170041, 0.08855681, 0.02657749, -0.047030363, 0.07507626, -0.0036172476, -0.011332732, 0.09223379, -0.035123598, 0.07849929, -0.0073014772, -0.06407317, -0.041441977, 0.042889312, 0.038899496, -0.028433122, 0.013948647, 0.03332241, -0.009083656, 0.013755987, -0.038682193, 0.012088305, 8.459411E-4, -0.047591258, -0.03445639, -0.024129298, 0.03151862, 0.06664521, 0.008410466, -0.04966618, -3.5810814E-4, -0.05254022, 0.032581992, 0.076965645, -0.008174543, 0.024454173, 0.058821585, -0.036225654, -0.036327284, 0.010284759, 0.0026733254, 0.012767942, 0.044172868, 0.079714224, 0.02428882, -0.058098882, -0.103700064, 0.036374588, 0.028864969, 0.057181194, -0.03133973, -0.036992326, -0.024063826, 0.032124367, -0.046390727, 0.06676919, -0.010181497, -0.07662079, 0.0016703316, -0.018343225, -0.047778722, 0.017997596, 0.03181875, -0.052517273, -0.010668479, 0.064985715, 0.039871912, 0.01582545, -0.007435942, -0.037521612, -0.041268304, -0.024208354, 0.019123953, -0.057927314, -0.042535316, -0.026476882, -0.025740117, -0.062421277, -0.008162225, 0.059145488, -0.06572626, 0.0068042623, -0.013353639, 0.045686264, 0.05418521, 0.04446112, 0.017125841, -0.056843452, -0.05248872, 0.009996208, -0.014766493, 0.047614425, 0.04417578, 0.09312503, 0.022321783, 0.06672458, -0.020294214, 0.06058907, -0.07796509, -0.017752886, -0.035484698, -0.019245343, -0.086269155, 0.03636968, -0.010473155, -0.027821833, 0.08724536, -0.036087383, -0.026622012, 0.012954949, -0.04286149, 0.057656605, 0.10062613, -0.0024973156, 0.026387101, 0.0060166116, -0.0025189642, -0.02720747, 0.005246455, 0.05420245, 2.9386661E-4, -0.032994796, -0.07233637, 0.01421499, -0.08565736, -0.066092595, 0.04123878, -0.057052527, 0.05104476, -0.022676067, 0.024916856, 0.043550193, 0.022787891, 0.06634744, 0.06282198, -0.028120825, 0.03855068, 0.029932909, -0.014963516, -0.023962902, 0.0330809, 0.027074838, -0.07884763, 0.009013065, -0.050303705, 0.04903634, 0.048968226, 0.025972977, 0.0059105, 0.026412955, 0.09550425, -0.041806895, 0.037700027, -0.00944356, -0.04365178, -0.003731535, -0.04677017, -0.021983983, -0.017476812, -0.0349582, 0.022780418, 0.02312234, -0.008466284, -0.048668552, -0.064449385, -0.039475206, -0.028146911, 0.02474613, -0.047006067, -0.0019405297, 0.031159727, 0.041920133, -0.03551462, -0.009635197, 0.002173243, 0.016199356, -0.0026587702, -0.040665075, 0.025064465, 0.039028086, 0.0410654, -0.052680694, 0.03621542, 0.05137614, -0.025629448, -0.022262543, -0.050236598, -0.06712357, -0.08511359, -0.020049553, 0.05228086, 0.01210039, -0.049958818, 0.03553515, -0.014649628, 0.01852075, -0.1578007, 0.04647171, -0.048130322, -0.11456476, 0.043893646, -0.039123375, -0.06064546, 0.022642506, 0.024047757, -0.038108468, -0.027887572, -0.035452798, -0.06386947, -0.059311286, -0.0597525, -0.033028368, -0.027785469, -0.014255441, 0.015038763, 0.031091997, 0.005895148, 0.056737326, 0.04310527, -0.021932026, 0.049093824, 0.042565376, 0.0024186873, -0.062797636, 0.07696433, -0.07480409, -0.002757164, 0.037501466, -0.0038974392, 0.013958516, -0.023316862, -0.02243059, -0.014469609, -0.072872445, -0.045017675, -0.09662722, -0.06683428, -0.076667175, 0.016889855, -0.05259447, 0.09901151, 0.008826699, 0.051874604, -0.063310854, 0.010331116, 0.0569754, 0.022930646, 0.015946256, -0.006152074, -0.063890666, -0.007055935, 0.022711016, 0.06597431, -0.016773408, 0.0454886, -0.022848401, 0.05452045, -0.04897417, -0.019524746, -0.06592306, -0.019679544, -0.009023872, -0.058356464, 0.06706891, -0.056862935, 0.048966084, 0.026170777, 0.034578174, -0.030989857, -0.025572322, -0.04439888, -0.037672643, 0.057903234, -0.027281458, -0.0067445496, 0.082111515, -6.9222995E-4, -0.031044275, -0.03536472, -0.03539842, 0.0015799046, -0.056929786, -0.026974991, 0.024494532, 0.062562846, 0.022763105, -0.03143849, 0.063723214, 0.03694335, -0.012629538, -0.0185742, -0.032778334, 0.007738178, -0.046297673, 0.11095108, 0.033049, 0.023627881, 0.078807965, -0.0134094, 0.007088767, -0.061255455, 0.0019925626, -0.028554654, -0.05853438, -0.045480233";
        String[] s = strFeature.replace(" ", "").split(",");
        for (String temp : s) {
            query_list.add(Float.parseFloat(temp));
        }

        int topK = 2;

        List<QueryRes> res = milvusService.query(appId, query_list, topK);

        for (QueryRes temp : res) {
            System.out.println(String.format("entityId is %d , distance is %f", temp.getEntityId(), temp.getDistance()));
        }
    }

    @Test
    public void testDelete() {
        String appId = "face";
        Long entityId = 300000L;
        milvusService.delete(appId, entityId);
    }

    @Test
    public void testCreateCollection() {
        String appId = "test";
        milvusService.createCollection(appId);
    }


    @Test
    public void testDropCollection() {
        String appId = "test";
        milvusService.dropCollection(appId);
    }

    @Test
    public void testBatchInsert() {
        String appId = "face";

        List<List<Float>> list = new LinkedList<>();
        List<Float> query_list = new LinkedList<>();
        String strFeature = "-0.0055829533, -0.05252821, 0.045498915, 0.027684057, -0.014731865, 0.017963886, 0.023751553, 0.05204888, -0.017745322, -0.064760566, 0.020972243, 0.048426833, -0.07709769, -0.021441981, 0.028780727, 0.04748312, -0.06179707, -0.053059425, 0.030665006, 0.022615338, -0.06291669, 0.067358434, -0.022109438, 0.06483583, 0.059896298, -0.03453572, 0.054612305, 0.016745212, -0.108223155, -0.06908608, -0.024598412, -0.0265966, -0.03950638, -0.0034397007, -0.042136118, -0.05123543, 0.0590316, -0.049851395, -0.034447048, 0.014572497, 0.037975308, 0.027077494, 0.06131909, 0.040654838, 0.024475677, 0.027959708, 0.057738606, -0.04608711, -0.01920095, -0.07413682, -0.048362654, -0.021702839, -0.020294387, -0.006079467, -0.06403117, -0.085131116, 0.0059753354, 0.0331481, -0.005049809, 0.07701836, 0.038597703, 0.0016531858, 0.062389836, -0.055956904, -0.09093616, -0.0069559976, -0.024187777, -0.0013998124, 0.011885589, 0.008950807, 0.032283496, -0.026219485, -0.016282247, 0.022982227, -0.0020866033, 0.0124436, -0.0026165033, 0.0094944, -0.035333574, -0.046104934, 0.045540523, 0.061459623, -0.005642663, -0.026882628, 0.03501887, 0.068248324, -0.022550117, -0.01283464, -0.09680264, 0.013322089, -0.0037654832, -0.0066057243, 0.035339862, 0.047094923, -1.7291073E-4, 0.023921039, -0.06834752, -4.5249547E-4, 0.028334497, 0.03943491, -0.036323104, 0.037875548, -0.037171885, 0.07799917, -0.009970036, -0.0137152895, 0.043048568, -0.023905173, -0.0038948571, -0.020153917, -0.018465197, 0.020302152, 0.009679929, -0.016298441, -0.049297065, -0.058576874, 0.026938241, -0.010931162, 0.013422858, 0.056898456, -0.048746306, 0.026552347, -0.017022101, 0.04336353, 0.03464659, 4.640521E-4, -0.004665707, 0.036609724, -0.06378838, 0.042397253, -0.011159567, -0.0047367476, -0.061266672, -0.04507367, 0.06943897, -0.05169623, -0.03327603, 0.04451255, -0.0076074977, -0.00877303, 0.009340342, -0.03858022, -0.042426832, 0.052511275, 0.110036656, -0.046440795, -0.010793275, -0.0073878323, 0.0022409128, -0.028041992, -0.03263694, 0.033953637, -0.053477813, -0.015962001, 0.04837572, -0.07061127, 0.0046661943, 0.014093273, -0.049537174, -0.0446542, 0.02700122, 0.033376053, -0.09943011, -0.06626195, -0.09429548, 0.029650288, 0.023459174, -0.0017580914, -0.01362791, -0.018901518, 0.047988545, -0.0012865294, 0.020184763, -0.04141823, -0.075608306, -0.0100300135, -0.062187422, 0.02398144, 0.025065396, -0.013512214, 0.064370096, 0.019878363, -0.020921059, 0.035334315, 0.03567038, -0.013564578, 0.014935359, 0.05767741, -0.027855853, 0.072637424, 0.020254267, 0.06742414, 0.03082894, -0.063118555, -0.018025378, 0.02366266, 0.0045260526, 0.11448336, 0.0189172, -0.006509951, -0.015901005, -0.0023374262, -0.02125802, -0.016092516, 0.099977374, -0.023346974, -0.011715805, -0.05170041, 0.08855681, 0.02657749, -0.047030363, 0.07507626, -0.0036172476, -0.011332732, 0.09223379, -0.035123598, 0.07849929, -0.0073014772, -0.06407317, -0.041441977, 0.042889312, 0.038899496, -0.028433122, 0.013948647, 0.03332241, -0.009083656, 0.013755987, -0.038682193, 0.012088305, 8.459411E-4, -0.047591258, -0.03445639, -0.024129298, 0.03151862, 0.06664521, 0.008410466, -0.04966618, -3.5810814E-4, -0.05254022, 0.032581992, 0.076965645, -0.008174543, 0.024454173, 0.058821585, -0.036225654, -0.036327284, 0.010284759, 0.0026733254, 0.012767942, 0.044172868, 0.079714224, 0.02428882, -0.058098882, -0.103700064, 0.036374588, 0.028864969, 0.057181194, -0.03133973, -0.036992326, -0.024063826, 0.032124367, -0.046390727, 0.06676919, -0.010181497, -0.07662079, 0.0016703316, -0.018343225, -0.047778722, 0.017997596, 0.03181875, -0.052517273, -0.010668479, 0.064985715, 0.039871912, 0.01582545, -0.007435942, -0.037521612, -0.041268304, -0.024208354, 0.019123953, -0.057927314, -0.042535316, -0.026476882, -0.025740117, -0.062421277, -0.008162225, 0.059145488, -0.06572626, 0.0068042623, -0.013353639, 0.045686264, 0.05418521, 0.04446112, 0.017125841, -0.056843452, -0.05248872, 0.009996208, -0.014766493, 0.047614425, 0.04417578, 0.09312503, 0.022321783, 0.06672458, -0.020294214, 0.06058907, -0.07796509, -0.017752886, -0.035484698, -0.019245343, -0.086269155, 0.03636968, -0.010473155, -0.027821833, 0.08724536, -0.036087383, -0.026622012, 0.012954949, -0.04286149, 0.057656605, 0.10062613, -0.0024973156, 0.026387101, 0.0060166116, -0.0025189642, -0.02720747, 0.005246455, 0.05420245, 2.9386661E-4, -0.032994796, -0.07233637, 0.01421499, -0.08565736, -0.066092595, 0.04123878, -0.057052527, 0.05104476, -0.022676067, 0.024916856, 0.043550193, 0.022787891, 0.06634744, 0.06282198, -0.028120825, 0.03855068, 0.029932909, -0.014963516, -0.023962902, 0.0330809, 0.027074838, -0.07884763, 0.009013065, -0.050303705, 0.04903634, 0.048968226, 0.025972977, 0.0059105, 0.026412955, 0.09550425, -0.041806895, 0.037700027, -0.00944356, -0.04365178, -0.003731535, -0.04677017, -0.021983983, -0.017476812, -0.0349582, 0.022780418, 0.02312234, -0.008466284, -0.048668552, -0.064449385, -0.039475206, -0.028146911, 0.02474613, -0.047006067, -0.0019405297, 0.031159727, 0.041920133, -0.03551462, -0.009635197, 0.002173243, 0.016199356, -0.0026587702, -0.040665075, 0.025064465, 0.039028086, 0.0410654, -0.052680694, 0.03621542, 0.05137614, -0.025629448, -0.022262543, -0.050236598, -0.06712357, -0.08511359, -0.020049553, 0.05228086, 0.01210039, -0.049958818, 0.03553515, -0.014649628, 0.01852075, -0.1578007, 0.04647171, -0.048130322, -0.11456476, 0.043893646, -0.039123375, -0.06064546, 0.022642506, 0.024047757, -0.038108468, -0.027887572, -0.035452798, -0.06386947, -0.059311286, -0.0597525, -0.033028368, -0.027785469, -0.014255441, 0.015038763, 0.031091997, 0.005895148, 0.056737326, 0.04310527, -0.021932026, 0.049093824, 0.042565376, 0.0024186873, -0.062797636, 0.07696433, -0.07480409, -0.002757164, 0.037501466, -0.0038974392, 0.013958516, -0.023316862, -0.02243059, -0.014469609, -0.072872445, -0.045017675, -0.09662722, -0.06683428, -0.076667175, 0.016889855, -0.05259447, 0.09901151, 0.008826699, 0.051874604, -0.063310854, 0.010331116, 0.0569754, 0.022930646, 0.015946256, -0.006152074, -0.063890666, -0.007055935, 0.022711016, 0.06597431, -0.016773408, 0.0454886, -0.022848401, 0.05452045, -0.04897417, -0.019524746, -0.06592306, -0.019679544, -0.009023872, -0.058356464, 0.06706891, -0.056862935, 0.048966084, 0.026170777, 0.034578174, -0.030989857, -0.025572322, -0.04439888, -0.037672643, 0.057903234, -0.027281458, -0.0067445496, 0.082111515, -6.9222995E-4, -0.031044275, -0.03536472, -0.03539842, 0.0015799046, -0.056929786, -0.026974991, 0.024494532, 0.062562846, 0.022763105, -0.03143849, 0.063723214, 0.03694335, -0.012629538, -0.0185742, -0.032778334, 0.007738178, -0.046297673, 0.11095108, 0.033049, 0.023627881, 0.078807965, -0.0134094, 0.007088767, -0.061255455, 0.0019925626, -0.028554654, -0.05853438, -0.045480233";
        String[] s = strFeature.replace(" ", "").split(",");
        for (String temp : s) {
            query_list.add(Float.parseFloat(temp));
        }
        list.add(query_list);
        list.add(query_list);
        list.add(query_list);


        List<Long> entityIds = new LinkedList<>();
        entityIds.add(3000000L);
        entityIds.add(3000001L);
        entityIds.add(3000002L);

        milvusService.batchInsert(appId, list, entityIds);

    }

    @Test
    public void testBatchDelete() {
        String appId = "face";

        List<Long> entityIds = new LinkedList<>();
        entityIds.add(3000000L);
        entityIds.add(3000001L);
        entityIds.add(3000002L);

        milvusService.batchDelete(appId, entityIds);
    }

    @Test
    public void testBatchQuery() {

        String appId = "face";


        List<Float> query_list = new LinkedList<>();
        String strFeature = "-0.0055829533, -0.05252821, 0.045498915, 0.027684057, -0.014731865, 0.017963886, 0.023751553, 0.05204888, -0.017745322, -0.064760566, 0.020972243, 0.048426833, -0.07709769, -0.021441981, 0.028780727, 0.04748312, -0.06179707, -0.053059425, 0.030665006, 0.022615338, -0.06291669, 0.067358434, -0.022109438, 0.06483583, 0.059896298, -0.03453572, 0.054612305, 0.016745212, -0.108223155, -0.06908608, -0.024598412, -0.0265966, -0.03950638, -0.0034397007, -0.042136118, -0.05123543, 0.0590316, -0.049851395, -0.034447048, 0.014572497, 0.037975308, 0.027077494, 0.06131909, 0.040654838, 0.024475677, 0.027959708, 0.057738606, -0.04608711, -0.01920095, -0.07413682, -0.048362654, -0.021702839, -0.020294387, -0.006079467, -0.06403117, -0.085131116, 0.0059753354, 0.0331481, -0.005049809, 0.07701836, 0.038597703, 0.0016531858, 0.062389836, -0.055956904, -0.09093616, -0.0069559976, -0.024187777, -0.0013998124, 0.011885589, 0.008950807, 0.032283496, -0.026219485, -0.016282247, 0.022982227, -0.0020866033, 0.0124436, -0.0026165033, 0.0094944, -0.035333574, -0.046104934, 0.045540523, 0.061459623, -0.005642663, -0.026882628, 0.03501887, 0.068248324, -0.022550117, -0.01283464, -0.09680264, 0.013322089, -0.0037654832, -0.0066057243, 0.035339862, 0.047094923, -1.7291073E-4, 0.023921039, -0.06834752, -4.5249547E-4, 0.028334497, 0.03943491, -0.036323104, 0.037875548, -0.037171885, 0.07799917, -0.009970036, -0.0137152895, 0.043048568, -0.023905173, -0.0038948571, -0.020153917, -0.018465197, 0.020302152, 0.009679929, -0.016298441, -0.049297065, -0.058576874, 0.026938241, -0.010931162, 0.013422858, 0.056898456, -0.048746306, 0.026552347, -0.017022101, 0.04336353, 0.03464659, 4.640521E-4, -0.004665707, 0.036609724, -0.06378838, 0.042397253, -0.011159567, -0.0047367476, -0.061266672, -0.04507367, 0.06943897, -0.05169623, -0.03327603, 0.04451255, -0.0076074977, -0.00877303, 0.009340342, -0.03858022, -0.042426832, 0.052511275, 0.110036656, -0.046440795, -0.010793275, -0.0073878323, 0.0022409128, -0.028041992, -0.03263694, 0.033953637, -0.053477813, -0.015962001, 0.04837572, -0.07061127, 0.0046661943, 0.014093273, -0.049537174, -0.0446542, 0.02700122, 0.033376053, -0.09943011, -0.06626195, -0.09429548, 0.029650288, 0.023459174, -0.0017580914, -0.01362791, -0.018901518, 0.047988545, -0.0012865294, 0.020184763, -0.04141823, -0.075608306, -0.0100300135, -0.062187422, 0.02398144, 0.025065396, -0.013512214, 0.064370096, 0.019878363, -0.020921059, 0.035334315, 0.03567038, -0.013564578, 0.014935359, 0.05767741, -0.027855853, 0.072637424, 0.020254267, 0.06742414, 0.03082894, -0.063118555, -0.018025378, 0.02366266, 0.0045260526, 0.11448336, 0.0189172, -0.006509951, -0.015901005, -0.0023374262, -0.02125802, -0.016092516, 0.099977374, -0.023346974, -0.011715805, -0.05170041, 0.08855681, 0.02657749, -0.047030363, 0.07507626, -0.0036172476, -0.011332732, 0.09223379, -0.035123598, 0.07849929, -0.0073014772, -0.06407317, -0.041441977, 0.042889312, 0.038899496, -0.028433122, 0.013948647, 0.03332241, -0.009083656, 0.013755987, -0.038682193, 0.012088305, 8.459411E-4, -0.047591258, -0.03445639, -0.024129298, 0.03151862, 0.06664521, 0.008410466, -0.04966618, -3.5810814E-4, -0.05254022, 0.032581992, 0.076965645, -0.008174543, 0.024454173, 0.058821585, -0.036225654, -0.036327284, 0.010284759, 0.0026733254, 0.012767942, 0.044172868, 0.079714224, 0.02428882, -0.058098882, -0.103700064, 0.036374588, 0.028864969, 0.057181194, -0.03133973, -0.036992326, -0.024063826, 0.032124367, -0.046390727, 0.06676919, -0.010181497, -0.07662079, 0.0016703316, -0.018343225, -0.047778722, 0.017997596, 0.03181875, -0.052517273, -0.010668479, 0.064985715, 0.039871912, 0.01582545, -0.007435942, -0.037521612, -0.041268304, -0.024208354, 0.019123953, -0.057927314, -0.042535316, -0.026476882, -0.025740117, -0.062421277, -0.008162225, 0.059145488, -0.06572626, 0.0068042623, -0.013353639, 0.045686264, 0.05418521, 0.04446112, 0.017125841, -0.056843452, -0.05248872, 0.009996208, -0.014766493, 0.047614425, 0.04417578, 0.09312503, 0.022321783, 0.06672458, -0.020294214, 0.06058907, -0.07796509, -0.017752886, -0.035484698, -0.019245343, -0.086269155, 0.03636968, -0.010473155, -0.027821833, 0.08724536, -0.036087383, -0.026622012, 0.012954949, -0.04286149, 0.057656605, 0.10062613, -0.0024973156, 0.026387101, 0.0060166116, -0.0025189642, -0.02720747, 0.005246455, 0.05420245, 2.9386661E-4, -0.032994796, -0.07233637, 0.01421499, -0.08565736, -0.066092595, 0.04123878, -0.057052527, 0.05104476, -0.022676067, 0.024916856, 0.043550193, 0.022787891, 0.06634744, 0.06282198, -0.028120825, 0.03855068, 0.029932909, -0.014963516, -0.023962902, 0.0330809, 0.027074838, -0.07884763, 0.009013065, -0.050303705, 0.04903634, 0.048968226, 0.025972977, 0.0059105, 0.026412955, 0.09550425, -0.041806895, 0.037700027, -0.00944356, -0.04365178, -0.003731535, -0.04677017, -0.021983983, -0.017476812, -0.0349582, 0.022780418, 0.02312234, -0.008466284, -0.048668552, -0.064449385, -0.039475206, -0.028146911, 0.02474613, -0.047006067, -0.0019405297, 0.031159727, 0.041920133, -0.03551462, -0.009635197, 0.002173243, 0.016199356, -0.0026587702, -0.040665075, 0.025064465, 0.039028086, 0.0410654, -0.052680694, 0.03621542, 0.05137614, -0.025629448, -0.022262543, -0.050236598, -0.06712357, -0.08511359, -0.020049553, 0.05228086, 0.01210039, -0.049958818, 0.03553515, -0.014649628, 0.01852075, -0.1578007, 0.04647171, -0.048130322, -0.11456476, 0.043893646, -0.039123375, -0.06064546, 0.022642506, 0.024047757, -0.038108468, -0.027887572, -0.035452798, -0.06386947, -0.059311286, -0.0597525, -0.033028368, -0.027785469, -0.014255441, 0.015038763, 0.031091997, 0.005895148, 0.056737326, 0.04310527, -0.021932026, 0.049093824, 0.042565376, 0.0024186873, -0.062797636, 0.07696433, -0.07480409, -0.002757164, 0.037501466, -0.0038974392, 0.013958516, -0.023316862, -0.02243059, -0.014469609, -0.072872445, -0.045017675, -0.09662722, -0.06683428, -0.076667175, 0.016889855, -0.05259447, 0.09901151, 0.008826699, 0.051874604, -0.063310854, 0.010331116, 0.0569754, 0.022930646, 0.015946256, -0.006152074, -0.063890666, -0.007055935, 0.022711016, 0.06597431, -0.016773408, 0.0454886, -0.022848401, 0.05452045, -0.04897417, -0.019524746, -0.06592306, -0.019679544, -0.009023872, -0.058356464, 0.06706891, -0.056862935, 0.048966084, 0.026170777, 0.034578174, -0.030989857, -0.025572322, -0.04439888, -0.037672643, 0.057903234, -0.027281458, -0.0067445496, 0.082111515, -6.9222995E-4, -0.031044275, -0.03536472, -0.03539842, 0.0015799046, -0.056929786, -0.026974991, 0.024494532, 0.062562846, 0.022763105, -0.03143849, 0.063723214, 0.03694335, -0.012629538, -0.0185742, -0.032778334, 0.007738178, -0.046297673, 0.11095108, 0.033049, 0.023627881, 0.078807965, -0.0134094, 0.007088767, -0.061255455, 0.0019925626, -0.028554654, -0.05853438, -0.045480233";
        String[] s = strFeature.replace(" ", "").split(",");
        for (String temp : s) {
            query_list.add(Float.parseFloat(temp));
        }

        List<List<Float>> allQueryFeature = new LinkedList<>();
        allQueryFeature.add(query_list);
        allQueryFeature.add(query_list);
        allQueryFeature.add(query_list);

        int topK = 3;

        List<List<QueryRes>> lists = milvusService.batchQuery(appId, allQueryFeature, topK);

        for (List<QueryRes> list:lists){
            for (QueryRes temp : list) {
                System.out.println(String.format("entityId is %d , distance is %f", temp.getEntityId(), temp.getDistance()));
            }
            System.out.println("-----------------------------------");
        }



    }


}
